<style>
    table {
        background-color: white;
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
    }
    th {
        background-color: #3B3E7C;
        color: white;
        position: sticky;
        top: 0;
        z-index: 2;
    }
   
    .table-container {
        max-height: 450px; /* Set a max height for the table container */
        overflow-y: auto; /* Enable vertical scrolling */
        margin-top: 20px; /* Add some margin for spacing */
        width: 100%;
    }
    .btn{
    background-color: #4CAF50 ;
    color: #FFFFFF;
    border-radius: 24px;
    width: 30%;
}
</style>




<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body p-3">
            <h2 class="card-title mb-3" id="name-of-class">الغيابات</h2>
            <hr>
            <div class="row mt-4">
                
                    <div class="col-md-4">
                        <input type="date" class="form-control" id="date">
                    </div>
               
                
                <div class="col-md-3">
                    <select class="form-select" id="class">
                        <option value="" disabled selected>الصف</option>
                        <option value="السادس الأساسي">السادس الأساسي</option>
                        <option value="السابع الأساسي">السابع الأساسي</option>
                        <option value="الثامن الأساسي">الثامن الأساسي</option>
                        <option value="التاسع الأساسي">التاسع الأساسي</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="section">
                        <option value="" disabled selected>الشعبة</option>
                        <option value="1">1</option>
                        <option value ="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button id="search-btn" class="btn btn-primary w-100">بحث</button>
                </div>
                
            </div>
            <!-- <div class="row mt-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" placeholder="اسم الطالب">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary w-100">بحث</button>
                </div>
            </div> -->
        </div>
    </div>
</div>


<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>إسم الطالبة</th>
                <th>الصف</th>
                <th>الشعبة</th>
                <th> تاريخ الغياب  </th>
            </tr>
        </thead>
        <tbody id="students-table">
          
        </tbody>
    </table>
    
</div>


<script>

function collectData(){
    const date = document.getElementById('date').value;
    // const classs = document.getElementById('class').value;
    // const section = document.getElementById('section').value;
    // console.log(typeof(date));
    // console.log(classs);
    // console.log(section);
    AbsenceByDate(date);
}

function AddEvent() {
    const btn = document.getElementById('search-btn');
    btn.addEventListener('click' , collectData);
}

async function AbsenceByDate(date) {
    const url=`http://localhost:3000/student/absence/by/date?dateString=${date}`;
    try{
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const absences = await response.json();

        const tableBody = document.getElementById('students-table');
        tableBody.innerHTML = ''; 

        if(absences.length > 0){
            absences.forEach(absence=> {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${absence.student.name}</td>
                        <td>${absence.student.class}</td>
                        <td>${absence.student.section}</td>
                        <td>${absence.date}</td>
                    `;
                    tableBody.appendChild(row);
                });
        }
        else{
            tableBody.innerHTML = `<tr><td colspan="4">${absences.message}</td></tr>`;
        }
    }
    catch(e){
        document.getElementById('students-table').innerHTML = `<tr><td colspan="5" style="color: red;">خطأ: ${error.message}</td></tr>`;
    }
}


    AddEvent();


</script>