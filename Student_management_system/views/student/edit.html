<style>
    .form-container {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
.form-control {
    background-color: #e9ecef;
    border: none;
    height: 40px;
}
.btn{
    background-color: #4CAF50 ;
    color: #FFFFFF;
    border-radius: 24px;
    width: 30%;
}
</style>




<div class="container d-flex flex-column mt-3" style="padding-top: 18px; gap: 30px;">
    <div>
       <span class="mb-3" style="font-size: 2rem;"> تعديل طالبة :   </span>
       <hr>
   </div>
</div>

<div class="d-flex justify-content-center align-items-center" style="width: 85%;">
    <div class="container">
        <div class="form-container">
            <form id="studentForm">
                <input type="hidden" id="student-id">
                <div class="mb-3">
                    <label class="form-label">اسم الطالب/ة :</label>
                    <input type="text" class="form-control" id="student-name" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">رقم الأب :</label>
                    <input type="text" class="form-control" required id="fatherPhone">
                </div>
                <div class="mb-3">
                    <label class="form-label">رقم الأم :</label>
                    <input type="text" class="form-control" required id="motherPhone">
                </div>
                <div class="mb-3">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">الصف الدراسي :</label>
                            <select class="form-select" id="student-class" required>
                                <option value="" disabled selected>اختر الصف الدراسي</option>
                                <option value="السادس الأساسي">السادس الأساسي</option>
                                <option value="السابع الأساسي">السابع الأساسي</option>
                                <option value="الثامن الأساسي">الثامن الأساسي</option>
                                <option value="التاسع الأساسي">التاسع الأساسي</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">الشعبة :</label>
                            <select class="form-select" id="student-section" required>
                                <option value="" disabled selected>اختر الشعبة</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center mt-4">
                    <button type="submit" class="btn btn-primary px-4">حفظ</button>
                </div>
            </form>
            <div id="message" class="mt-3"></div>

        </div>
    </div>
</div>

<script>
      function navigate(page , classs , section) {
        const content = document.getElementById('sub_content');
        sessionStorage.setItem('classs', classs);
        sessionStorage.setItem('section', section);
        fetch(page)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(html => {
                content.innerHTML = html; // Set the content
                executeScripts(content); // Execute scripts manually
            })
            .catch(err => {
                content.innerHTML = `<p style="color: red;">Failed to load page: ${err.message}</p>`;
            });
    }

    function executeScripts(element) {
        const scripts = element.getElementsByTagName('script');
        for (let i = 0; i < scripts.length; i++) {
            const newScript = document.createElement('script');
            newScript.text = scripts[i].text; // Copy the script content
            document.body.appendChild(newScript).parentNode.removeChild(newScript); // Execute script
        }
    }





   async function loadStudentData() {
        const studentId = JSON.parse(sessionStorage.getItem('studentId')).trim();
        try{
            const url=`http://localhost:3000/student?id=${studentId}`;
            const response = await fetch(url,{method:'GET'});
            if(! response.ok){
                throw new Error('HTTP error: ' + response.status);
            }
            const data = await response.json(); // Parse the JSON response

            document.getElementById('student-name').value=data.name
            document.getElementById('student-class').value = data.class;
            document.getElementById('student-section').value = data.section;
            document.getElementById('fatherPhone').value = data.fatherPhone || '';
            document.getElementById('motherPhone').value = data.motherPhone || '';
            document.getElementById('student-id').value = data._id;

        }
        catch(e){
            alert('خطأ في الأتصال بالخادم' + e.message);
        }
    }



    document.getElementById('studentForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent the default form submission
            const id = document.getElementById('student-id').value;
            const name = document.getElementById('student-name').value;
            const classs = document.getElementById('student-class').value;
            const sectionStr = document.getElementById('student-section').value;
            const fatherPhone = document.getElementById('fatherPhone').value;
            const motherPhone = document.getElementById('motherPhone').value;
            console.log(id);
            const section = parseInt(sectionStr, 10);
    
        const data = {
            id,
            name,
            classs,
            section,
            fatherPhone,
            motherPhone
        };
        try {
            const response = await fetch('http://localhost:3000/student/update', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            console.log(result);

            const messageDiv = document.getElementById('message');
            if (response.ok) {
                messageDiv.innerHTML = `<div class="alert alert-success">${result.message}</div>`;
                //alert(`${result.message}`);
                
            } 
            else if(result.message){
                messageDiv.innerHTML = `<div class="alert alert-danger">${result.message}</div>`;
                
            }
            else{
                messageDiv.innerHTML = `<div class="alert alert-danger">${result.errors}</div>`;
            }
        } catch (error) {
            console.error('Error:', error);
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="alert alert-danger">حدث خطأ أثناء الاتصال بالخادم</div>`;
        }
    }); 
    
    loadStudentData();
</script>